<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive Socio-Crime Analysis Dashboard - Explore crime data, GDP correlations, and statistical insights">
    <title>Socio-Crime Analysis Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson@3/dist/topojson.min.js"></script>
    <script>
        // Debug: Check if libraries loaded
        window.addEventListener('DOMContentLoaded', function() {
            console.log('=== Library Check ===');
            console.log('D3.js:', typeof d3 !== 'undefined' ? '✓ Loaded' : '✗ Missing');
            console.log('TopoJSON:', typeof topojson !== 'undefined' ? '✓ Loaded' : '✗ Missing');
            console.log('Vue:', typeof Vue !== 'undefined' ? '✓ Loaded' : '✗ Missing');
        });
    </script>
</head>
<body>
    <div id="app">
        <!-- Enhanced Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-dark sticky-top shadow-lg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="container-fluid px-4">
                <a class="navbar-brand d-flex align-items-center fw-bold" href="#" style="font-size: 1.5rem;">
                    <i class="bi bi-shield-check me-2" style="font-size: 1.75rem;"></i>
                    <span>Socio-Crime Analysis</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active d-flex align-items-center" href="dashboard.html" style="font-weight: 500;">
                                <i class="bi bi-speedometer2 me-2"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                    </ul>
                    <div class="d-flex align-items-center ms-3">
                        <span v-if="loading" class="text-light">
                            <span class="spinner-border spinner-border-sm me-2"></span>
                            <small>Loading...</small>
                        </span>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container-fluid mt-4 px-3">
            <!-- Enhanced Filters Panel -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-lg border-0">
                        <div class="card-header bg-gradient-primary text-white py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">
                                        <i class="bi bi-funnel me-2"></i>Filters & Controls
                                    </h5>
                                    <small class="text-white-50">Customize your data view and analysis</small>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input form-check-input-lg" type="checkbox" 
                                           id="mapViewToggle" v-model="mapViewMode" 
                                           aria-label="Toggle between map view and list view">
                                    <label class="form-check-label text-white fw-bold" for="mapViewToggle">
                                        <i :class="mapViewMode ? 'bi bi-map' : 'bi bi-list-ul'" class="me-1"></i>
                                        {{ mapViewMode ? 'Map View' : 'List View' }}
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="card-body bg-dark">
                            <!-- Map View -->
                            <div v-if="mapViewMode" class="row">
                                <div class="col-12 text-center mb-4">
                                    <div id="us-map-chart" class="map-container" style="height: 500px; margin: 0 auto; border-radius: 8px; overflow: hidden;"></div>
                                    <div class="mt-3">
                                        <div class="alert alert-info d-inline-flex align-items-center py-2 px-3" role="alert">
                                            <i class="bi bi-info-circle me-2"></i>
                                            <small>
                                                <strong>Tip:</strong> Click states to select/deselect. 
                                                Double-click a state to view counties. 
                                                <span class="badge bg-primary ms-2">{{ selectedStates.length }} states</span>
                                                <span class="badge bg-success ms-1">{{ selectedCounties.length }} counties</span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Filters below map in map view -->
                                <div class="col-12 mt-3">
                                    <div class="row g-3 justify-content-center">
                                        <!-- Year Filter -->
                                        <div class="col-md-2 col-lg-2">
                                            <label class="form-label fw-bold text-white">
                                                <i class="bi bi-calendar3 me-1"></i>Years
                                            </label>
                                            <select class="form-select form-select-sm" multiple v-model="selectedYears" 
                                                    @change="applyFilters" style="height: 120px;"
                                                    aria-label="Select years">
                                                <option v-for="year in uniqueYears" :key="year" :value="year" 
                                                        :selected="selectedYears.includes(year)">
                                                    {{ year }}
                                                </option>
                                            </select>
                                            <small class="text-muted">
                                                <i class="bi bi-check-circle me-1"></i>{{ selectedYears.length }} selected
                                            </small>
                                        </div>

                                        <!-- Metrics Selector -->
                                        <div class="col-md-2 col-lg-2">
                                            <label class="form-label fw-bold text-white">
                                                <i class="bi bi-bar-chart me-1"></i>Metrics
                                            </label>
                                            <select class="form-select form-select-sm" multiple v-model="selectedMetrics" 
                                                    @change="applyFilters" style="height: 120px;"
                                                    aria-label="Select metrics to display">
                                                <optgroup label="Crime Metrics">
                                                    <option v-for="metric in availableMetrics.filter(m => m.category === 'crime')" 
                                                            :key="metric.key" 
                                                            :value="metric.key"
                                                            :selected="selectedMetrics.includes(metric.key)">
                                                        {{ metric.label }}
                                                    </option>
                                                </optgroup>
                                                <optgroup label="Economic Metrics">
                                                    <option v-for="metric in availableMetrics.filter(m => m.category === 'economic')" 
                                                            :key="metric.key" 
                                                            :value="metric.key"
                                                            :selected="selectedMetrics.includes(metric.key)">
                                                        {{ metric.label }}
                                                    </option>
                                                </optgroup>
                                            </select>
                                            <small class="text-muted">
                                                <i class="bi bi-check-circle me-1"></i>{{ selectedMetrics.length }} selected
                                            </small>
                                        </div>

                                        <!-- GDP Range Filter -->
                                        <div class="col-md-2 col-lg-2">
                                            <label class="form-label fw-bold text-white">
                                                <i class="bi bi-currency-dollar me-1"></i>GDP Per Capita Range
                                            </label>
                                            <div class="mb-2">
                                                <label class="small text-muted">Min: ${{ gdpRange[0].toLocaleString() }}</label>
                                                <input type="range" class="form-range" v-model.number="gdpRange[0]" 
                                                       :min="gdpMin" :max="gdpMax" @input="applyFilters"
                                                       aria-label="Minimum GDP per capita">
                                            </div>
                                            <div>
                                                <label class="small text-muted">Max: ${{ gdpRange[1].toLocaleString() }}</label>
                                                <input type="range" class="form-range" v-model.number="gdpRange[1]" 
                                                       :min="gdpMin" :max="gdpMax" @input="applyFilters"
                                                       aria-label="Maximum GDP per capita">
                                            </div>
                                        </div>

                                        <!-- Actions -->
                                        <div class="col-md-2 col-lg-2">
                                            <label class="form-label fw-bold text-white">
                                                <i class="bi bi-gear me-1"></i>Actions
                                            </label>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-primary btn-sm" @click="applyFilters" 
                                                        :disabled="loading" aria-label="Apply filters">
                                                    <i class="bi bi-search me-1"></i>
                                                    <span v-if="!loading">Apply Filters</span>
                                                    <span v-else>
                                                        <span class="spinner-border spinner-border-sm me-1"></span>Processing...
                                                    </span>
                                                </button>
                                                <button class="btn btn-outline-light btn-sm" @click="clearFilters" 
                                                        :disabled="loading" aria-label="Clear all filters">
                                                    <i class="bi bi-x-circle me-1"></i>Clear All
                                                </button>
                                            </div>
                                            <div class="mt-2 p-2 bg-secondary rounded">
                                                <small class="text-white">
                                                    <i class="bi bi-database me-1"></i>
                                                    <strong>{{ filteredDataCount.toLocaleString() }}</strong> records
                                                </small>
                                            </div>
                                        </div>
                                        
                                        <!-- County Filter (only show if one state selected) -->
                                        <div class="col-md-2 col-lg-2" v-if="selectedStates.length === 1">
                                            <label class="form-label fw-bold text-white">
                                                <i class="bi bi-geo-alt me-1"></i>Counties
                                            </label>
                                            <select class="form-select form-select-sm" multiple v-model="selectedCounties" 
                                                    @change="applyFilters" style="height: 120px;"
                                                    :aria-label="`Counties in ${selectedStates[0]}`">
                                                <option v-for="county in uniqueCounties" :key="county" :value="county">
                                                    {{ county }}
                                                </option>
                                            </select>
                                            <small class="text-muted">
                                                <i class="bi bi-check-circle me-1"></i>{{ selectedCounties.length }} selected
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- List View -->
                            <div v-else class="row g-3 justify-content-center">
                                <!-- State Filter -->
                                <div class="col-md-2 col-lg-2">
                                    <label class="form-label fw-bold text-white">
                                        <i class="bi bi-geo-alt-fill me-1"></i>States
                                    </label>
                                    <select class="form-select form-select-sm" multiple v-model="selectedStates" 
                                            @change="onStateChange" style="height: 120px;"
                                            aria-label="Select states">
                                        <option v-for="state in uniqueStates" :key="state" :value="state">
                                            {{ state }}
                                        </option>
                                    </select>
                                    <small class="text-muted">
                                        <i class="bi bi-check-circle me-1"></i>{{ selectedStates.length }} selected
                                    </small>
                                </div>

                                <!-- Year Filter -->
                                <div class="col-md-2 col-lg-2">
                                    <label class="form-label fw-bold text-white">
                                        <i class="bi bi-calendar3 me-1"></i>Years
                                    </label>
                                    <select class="form-select form-select-sm" multiple v-model="selectedYears" 
                                            @change="applyFilters" style="height: 120px;"
                                            aria-label="Select years">
                                        <option v-for="year in uniqueYears" :key="year" :value="year" 
                                                :selected="selectedYears.includes(year)">
                                            {{ year }}
                                        </option>
                                    </select>
                                    <small class="text-muted">
                                        <i class="bi bi-check-circle me-1"></i>{{ selectedYears.length }} selected
                                    </small>
                                </div>

                                <!-- Metrics Selector -->
                                <div class="col-md-2 col-lg-2">
                                    <label class="form-label fw-bold text-white">
                                        <i class="bi bi-bar-chart me-1"></i>Metrics
                                    </label>
                                    <select class="form-select form-select-sm" multiple v-model="selectedMetrics" 
                                            @change="applyFilters" style="height: 120px;"
                                            aria-label="Select metrics to display">
                                        <optgroup label="Crime Metrics">
                                            <option v-for="metric in availableMetrics.filter(m => m.category === 'crime')" 
                                                    :key="metric.key" 
                                                    :value="metric.key"
                                                    :selected="selectedMetrics.includes(metric.key)">
                                                {{ metric.label }}
                                            </option>
                                        </optgroup>
                                        <optgroup label="Economic Metrics">
                                            <option v-for="metric in availableMetrics.filter(m => m.category === 'economic')" 
                                                    :key="metric.key" 
                                                    :value="metric.key"
                                                    :selected="selectedMetrics.includes(metric.key)">
                                                {{ metric.label }}
                                            </option>
                                        </optgroup>
                                    </select>
                                    <small class="text-muted">
                                        <i class="bi bi-check-circle me-1"></i>{{ selectedMetrics.length }} selected
                                    </small>
                                </div>

                                <!-- County Filter -->
                                <div class="col-md-2 col-lg-2" v-if="selectedStates.length === 1">
                                    <label class="form-label fw-bold text-white">
                                        <i class="bi bi-geo-alt me-1"></i>Counties
                                    </label>
                                    <select class="form-select form-select-sm" multiple v-model="selectedCounties" 
                                            @change="applyFilters" style="height: 120px;"
                                            :aria-label="`Counties in ${selectedStates[0]}`">
                                        <option v-for="county in uniqueCounties" :key="county" :value="county">
                                            {{ county }}
                                        </option>
                                    </select>
                                    <small class="text-muted">
                                        <i class="bi bi-check-circle me-1"></i>{{ selectedCounties.length }} selected
                                    </small>
                                </div>

                                <!-- GDP Range Filter -->
                                <div class="col-md-2 col-lg-2">
                                    <label class="form-label fw-bold text-white">
                                        <i class="bi bi-currency-dollar me-1"></i>GDP Per Capita Range
                                    </label>
                                    <div class="mb-2">
                                        <label class="small text-muted">Min: ${{ gdpRange[0].toLocaleString() }}</label>
                                        <input type="range" class="form-range" v-model.number="gdpRange[0]" 
                                               :min="gdpMin" :max="gdpMax" @input="applyFilters"
                                               aria-label="Minimum GDP per capita">
                                    </div>
                                    <div>
                                        <label class="small text-muted">Max: ${{ gdpRange[1].toLocaleString() }}</label>
                                        <input type="range" class="form-range" v-model.number="gdpRange[1]" 
                                               :min="gdpMin" :max="gdpMax" @input="applyFilters"
                                               aria-label="Maximum GDP per capita">
                                    </div>
                                </div>

                                <!-- Actions -->
                                <div class="col-md-2 col-lg-2">
                                    <label class="form-label fw-bold text-white">
                                        <i class="bi bi-gear me-1"></i>Actions
                                    </label>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary btn-sm" @click="applyFilters" 
                                                :disabled="loading" aria-label="Apply filters">
                                            <i class="bi bi-search me-1"></i>
                                            <span v-if="!loading">Apply Filters</span>
                                            <span v-else>
                                                <span class="spinner-border spinner-border-sm me-1"></span>Processing...
                                            </span>
                                        </button>
                                        <button class="btn btn-outline-light btn-sm" @click="clearFilters" 
                                                :disabled="loading" aria-label="Clear all filters">
                                            <i class="bi bi-x-circle me-1"></i>Clear All
                                        </button>
                                    </div>
                                    <div class="mt-2 p-2 bg-secondary rounded">
                                        <small class="text-white">
                                            <i class="bi bi-database me-1"></i>
                                            <strong>{{ filteredDataCount.toLocaleString() }}</strong> records
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Error Message -->
            <div v-if="error" class="alert alert-danger alert-dismissible fade show shadow-lg" role="alert">
                <div class="d-flex align-items-center">
                    <i class="bi bi-exclamation-triangle-fill me-3 fs-4"></i>
                    <div class="flex-grow-1">
                        <h6 class="alert-heading mb-1">Error</h6>
                        <p class="mb-0">{{ error }}</p>
                    </div>
                </div>
                <button type="button" class="btn-close" @click="error = null" aria-label="Close"></button>
            </div>

            <!-- Enhanced Key Metrics Summary -->
            <div class="row mb-4 g-2" v-if="dataSummary">
                <div class="col-md-3">
                    <div class="metric-card card text-white shadow-lg border-0 h-100 hover-lift" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div class="card-body text-center p-2">
                            <div class="metric-icon mb-1">
                                <i class="bi bi-database" style="font-size: 1.5rem;"></i>
                            </div>
                            <h6 class="card-title text-uppercase mb-1 opacity-75" style="font-size: 0.65rem; letter-spacing: 0.5px;">Total Records</h6>
                            <h2 class="mb-0 fw-bold" style="font-size: 1.75rem;">{{ dynamicMetrics.totalRecords.toLocaleString() }}</h2>
                            <small class="text-white-50 mt-1 d-block" style="font-size: 0.7rem;" v-if="filteredDataCount !== dynamicMetrics.totalRecords">
                                Filtered: {{ filteredDataCount.toLocaleString() }}
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card card text-white shadow-lg border-0 h-100 hover-lift" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="card-body text-center p-2">
                            <div class="metric-icon mb-1">
                                <i class="bi bi-shield-exclamation" style="font-size: 1.5rem;"></i>
                            </div>
                            <h6 class="card-title text-uppercase mb-1 opacity-75" style="font-size: 0.65rem; letter-spacing: 0.5px;">Avg Violent Crime Rate</h6>
                            <h2 class="mb-0 fw-bold" style="font-size: 1.75rem;">{{ dynamicMetrics.avgViolentCrimeRate.toFixed(1) }}</h2>
                            <small class="text-white-50 mt-1 d-block" style="font-size: 0.7rem;">
                                per 100k population
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card card text-white shadow-lg border-0 h-100 hover-lift" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <div class="card-body text-center p-2">
                            <div class="metric-icon mb-1">
                                <i class="bi bi-geo-alt" style="font-size: 1.5rem;"></i>
                            </div>
                            <h6 class="card-title text-uppercase mb-1 opacity-75" style="font-size: 0.65rem; letter-spacing: 0.5px;">Counties</h6>
                            <h2 class="mb-0 fw-bold" style="font-size: 1.75rem;">{{ dynamicMetrics.uniqueCounties }}</h2>
                            <small class="text-white-50 mt-1 d-block" style="font-size: 0.7rem;" v-if="selectedStates.length > 0">
                                {{ selectedStates.length }} state(s) selected
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card card text-white shadow-lg border-0 h-100 hover-lift" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <div class="card-body text-center p-2">
                            <div class="metric-icon mb-1">
                                <i class="bi bi-currency-dollar" style="font-size: 1.5rem;"></i>
                            </div>
                            <h6 class="card-title text-uppercase mb-1 opacity-75" style="font-size: 0.65rem; letter-spacing: 0.5px;">Avg GDP Per Capita</h6>
                            <h2 class="mb-0 fw-bold" style="font-size: 1.75rem;">${{ dynamicMetrics.avgGDPPerCapita.toLocaleString() }}</h2>
                            <small class="text-white-50 mt-1 d-block" style="font-size: 0.7rem;">
                                {{ dynamicMetrics.yearRange }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Row 1: Primary Dynamic Charts - 50/50 -->
            <div class="row mb-4 g-4">
                <!-- Time Series Chart -->
                <div class="col-lg-6">
                    <div class="card shadow-lg border-0 h-100 chart-card">
                        <div class="card-header bg-gradient-dark text-white py-3">
                            <div class="d-flex justify-content-between align-items-center flex-wrap">
                                <div class="flex-grow-1">
                                    <h5 class="mb-1">
                                        <i class="bi bi-graph-up-arrow me-2"></i>Crime Trends Over Time
                                    </h5>
                                    <small class="text-white-50">
                                        <i class="bi bi-info-circle me-1"></i>Select a metric to view its trend
                                    </small>
                                </div>
                                <div class="d-flex flex-wrap gap-2 mt-2 mt-md-0">
                                    <button 
                                        class="btn btn-sm btn-outline-light timeline-metric-btn active" 
                                        data-metric="violentCrimeRate"
                                        @click="setTimelineChartMetric('violentCrimeRate')"
                                        title="Violent Crime Rate">
                                        Violent
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light timeline-metric-btn" 
                                        data-metric="propertyCrimeRate"
                                        @click="setTimelineChartMetric('propertyCrimeRate')"
                                        title="Property Crime Rate">
                                        Property
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light timeline-metric-btn" 
                                        data-metric="murder"
                                        @click="setTimelineChartMetric('murder')"
                                        title="Murder">
                                        Murder
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light timeline-metric-btn" 
                                        data-metric="rape"
                                        @click="setTimelineChartMetric('rape')"
                                        title="Rape">
                                        Rape
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light timeline-metric-btn" 
                                        data-metric="robbery"
                                        @click="setTimelineChartMetric('robbery')"
                                        title="Robbery">
                                        Robbery
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light timeline-metric-btn" 
                                        data-metric="assault"
                                        @click="setTimelineChartMetric('assault')"
                                        title="Assault">
                                        Assault
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light timeline-metric-btn" 
                                        data-metric="burglary"
                                        @click="setTimelineChartMetric('burglary')"
                                        title="Burglary">
                                        Burglary
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light timeline-metric-btn" 
                                        data-metric="larceny"
                                        @click="setTimelineChartMetric('larceny')"
                                        title="Larceny">
                                        Larceny
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light timeline-metric-btn" 
                                        data-metric="motorTheft"
                                        @click="setTimelineChartMetric('motorTheft')"
                                        title="Motor Theft">
                                        Motor Theft
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light timeline-metric-btn" 
                                        data-metric="gdpPerCapita"
                                        @click="setTimelineChartMetric('gdpPerCapita')"
                                        title="GDP Per Capita">
                                        GDP/Cap
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 10px;">
                            <div id="timeline-chart" style="width: 100%; height: 400px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Scatter Plot -->
                <div class="col-lg-6">
                    <div class="card shadow-lg border-0 h-100 chart-card">
                        <div class="card-header bg-gradient-dark text-white py-3">
                            <div class="d-flex justify-content-between align-items-center flex-wrap">
                                <div class="flex-grow-1">
                                    <h5 class="mb-1">
                                        <i class="bi bi-scatter-chart me-2"></i>GDP vs <span id="scatter-chart-metric-label">Violent Crime Rate</span>
                                    </h5>
                                    <small class="text-white-50">
                                        <i class="bi bi-info-circle me-1"></i>Hover for detailed information
                                    </small>
                                </div>
                                <div class="d-flex flex-wrap gap-2 mt-2 mt-md-0">
                                    <button 
                                        class="btn btn-sm btn-outline-light scatter-metric-btn active" 
                                        data-metric="violentCrimeRate"
                                        @click="setScatterChartMetric('violentCrimeRate')"
                                        title="Violent Crime Rate">
                                        Violent
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light scatter-metric-btn" 
                                        data-metric="propertyCrimeRate"
                                        @click="setScatterChartMetric('propertyCrimeRate')"
                                        title="Property Crime Rate">
                                        Property
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light scatter-metric-btn" 
                                        data-metric="murder"
                                        @click="setScatterChartMetric('murder')"
                                        title="Murder">
                                        Murder
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light scatter-metric-btn" 
                                        data-metric="rape"
                                        @click="setScatterChartMetric('rape')"
                                        title="Rape">
                                        Rape
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light scatter-metric-btn" 
                                        data-metric="robbery"
                                        @click="setScatterChartMetric('robbery')"
                                        title="Robbery">
                                        Robbery
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light scatter-metric-btn" 
                                        data-metric="assault"
                                        @click="setScatterChartMetric('assault')"
                                        title="Assault">
                                        Assault
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light scatter-metric-btn" 
                                        data-metric="burglary"
                                        @click="setScatterChartMetric('burglary')"
                                        title="Burglary">
                                        Burglary
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light scatter-metric-btn" 
                                        data-metric="larceny"
                                        @click="setScatterChartMetric('larceny')"
                                        title="Larceny">
                                        Larceny
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light scatter-metric-btn" 
                                        data-metric="motorTheft"
                                        @click="setScatterChartMetric('motorTheft')"
                                        title="Motor Theft">
                                        Motor Theft
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 10px;">
                            <div id="scatter-chart" style="width: 100%; height: 400px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Row 2: Multi-dimensional Analysis - 50/50 -->
            <div class="row mb-4 g-4">
                <!-- Parallel Coordinates -->
                <div class="col-lg-6">
                    <div class="card shadow-lg border-0 h-100 chart-card">
                        <div class="card-header bg-gradient-dark text-white py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">
                                        <i class="bi bi-diagram-3 me-2"></i>Parallel Coordinates
                                    </h5>
                                    <small class="text-white-50">
                                        <i class="bi bi-info-circle me-1"></i>Multi-dimensional exploration - Hover lines for details
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 10px;">
                            <div id="parallel-chart" style="width: 100%; height: 400px;"></div>
                        </div>
                    </div>
                </div>

                <!-- State Comparison Bar Chart -->
                <div class="col-lg-6">
                    <div class="card shadow-lg border-0 h-100 chart-card">
                        <div class="card-header bg-gradient-dark text-white py-3">
                            <div class="d-flex justify-content-between align-items-center flex-wrap">
                                <div class="flex-grow-1">
                                    <h5 class="mb-1">
                                        <i class="bi bi-bar-chart me-2"></i>Top States by <span id="state-chart-metric-label">Violent Crime Rate</span>
                                    </h5>
                                    <small class="text-white-50">
                                        <i class="bi bi-info-circle me-1"></i>Updates with filter selections
                                    </small>
                                </div>
                                <div class="d-flex flex-wrap gap-2 mt-2 mt-md-0">
                                    <button 
                                        class="btn btn-sm btn-outline-light state-metric-btn active" 
                                        data-metric="violentCrimeRate"
                                        @click="setStateChartMetric('violentCrimeRate')"
                                        title="Violent Crime Rate">
                                        Violent
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light state-metric-btn" 
                                        data-metric="propertyCrimeRate"
                                        @click="setStateChartMetric('propertyCrimeRate')"
                                        title="Property Crime Rate">
                                        Property
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light state-metric-btn" 
                                        data-metric="murder"
                                        @click="setStateChartMetric('murder')"
                                        title="Murder">
                                        Murder
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light state-metric-btn" 
                                        data-metric="rape"
                                        @click="setStateChartMetric('rape')"
                                        title="Rape">
                                        Rape
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light state-metric-btn" 
                                        data-metric="robbery"
                                        @click="setStateChartMetric('robbery')"
                                        title="Robbery">
                                        Robbery
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light state-metric-btn" 
                                        data-metric="assault"
                                        @click="setStateChartMetric('assault')"
                                        title="Assault">
                                        Assault
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light state-metric-btn" 
                                        data-metric="burglary"
                                        @click="setStateChartMetric('burglary')"
                                        title="Burglary">
                                        Burglary
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light state-metric-btn" 
                                        data-metric="larceny"
                                        @click="setStateChartMetric('larceny')"
                                        title="Larceny">
                                        Larceny
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light state-metric-btn" 
                                        data-metric="motorTheft"
                                        @click="setStateChartMetric('motorTheft')"
                                        title="Motor Theft">
                                        Motor Theft
                                    </button>
                                    <button 
                                        class="btn btn-sm btn-outline-light state-metric-btn" 
                                        data-metric="gdpPerCapita"
                                        @click="setStateChartMetric('gdpPerCapita')"
                                        title="GDP Per Capita">
                                        GDP/Cap
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 10px;">
                            <div id="state-chart" style="width: 100%; height: 400px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Row 3: Interactive Specialized Charts - 50/50 -->
            <div class="row mb-4 g-4">
                <!-- Radar Chart -->
                <div class="col-lg-6">
                    <div class="card shadow-lg border-0 h-100 chart-card">
                        <div class="card-header bg-gradient-dark text-white py-3">
                            <div>
                                <h5 class="mb-1">
                                    <i class="bi bi-radar me-2"></i>State Comparison Radar Chart
                                </h5>
                                <small class="text-white-50">
                                    <i class="bi bi-info-circle me-1"></i>Shows states from main filter selection above
                                    <span v-if="selectedStates.length > 0" class="badge bg-primary ms-2">{{ selectedStates.length }} state(s)</span>
                                </small>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 10px;">
                            <div id="radar-chart" style="width: 100%; height: 400px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Treemap -->
                <div class="col-lg-6">
                    <div class="card shadow-lg border-0 h-100 chart-card">
                        <div class="card-header bg-gradient-dark text-white py-3">
                            <div>
                                <h5 class="mb-1">
                                    <i class="bi bi-diagram-2 me-2"></i>Hierarchical Treemap
                                </h5>
                                <small class="text-white-50">
                                    <i class="bi bi-info-circle me-1"></i>Size = Population, Color = Crime Rate
                                </small>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 10px;">
                            <div id="treemap-chart" style="width: 100%; height: 400px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Row 4: Distribution and Correlation Analysis -->
            <div class="row mb-4 g-4">
                <!-- Crime Breakdown Chart -->
                <div class="col-lg-4">
                    <div class="card shadow-lg border-0 h-100 chart-card d-flex flex-column">
                        <div class="card-header bg-gradient-dark text-white py-3">
                            <div>
                                <h5 class="mb-1">
                                    <i class="bi bi-pie-chart me-2"></i>Crime Type Breakdown
                                </h5>
                                <small class="text-white-50">
                                    <i class="bi bi-info-circle me-1"></i>Total counts by crime type
                                </small>
                            </div>
                        </div>
                        <div class="card-body flex-grow-1 d-flex align-items-center justify-content-center" style="padding: 15px; min-height: 450px;">
                            <div id="crime-breakdown-chart" style="width: 100%; height: 100%; min-height: 450px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Box Plot -->
                <div class="col-lg-4">
                    <div class="card shadow-lg border-0 h-100 chart-card d-flex flex-column">
                        <div class="card-header bg-gradient-dark text-white py-3">
                            <div>
                                <h5 class="mb-1">
                                    <i class="bi bi-box-plot me-2"></i>Crime Rate Distribution
                                </h5>
                                <small class="text-white-50">
                                    <i class="bi bi-info-circle me-1"></i>Shows quartiles, medians, and outliers
                                </small>
                            </div>
                        </div>
                        <div class="card-body flex-grow-1 d-flex align-items-center justify-content-center" style="padding: 15px; min-height: 450px;">
                            <div id="boxplot-chart" style="width: 100%; height: 100%; min-height: 450px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Correlation Heatmap -->
                <div class="col-lg-4">
                    <div class="card shadow-lg border-0 h-100 chart-card d-flex flex-column">
                        <div class="card-header bg-gradient-dark text-white py-3">
                            <div>
                                <h5 class="mb-1">
                                    <i class="bi bi-grid-3x3-gap me-2"></i>Correlation Heatmap
                                </h5>
                                <small class="text-white-50">
                                    <i class="bi bi-info-circle me-1"></i>Relationships between all variables
                                </small>
                            </div>
                        </div>
                        <div class="card-body flex-grow-1 d-flex align-items-center justify-content-center" style="padding: 15px; min-height: 450px;">
                            <div id="correlation-chart" style="width: 100%; height: 100%; min-height: 450px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- API Client -->
    <script src="js/api/client.js"></script>
    <!-- Chart Components -->
    <script src="js/components/timeline-chart.js"></script>
    <script src="js/components/scatter-chart.js"></script>
    <script src="js/components/state-chart.js"></script>
    <script src="js/components/parallel-coords.js"></script>
    <script src="js/components/radar-chart.js"></script>
    <script src="js/components/treemap-chart.js"></script>
    <script src="js/components/boxplot-chart.js"></script>
    <script src="js/components/correlation-chart.js"></script>
    <script src="js/components/us-map-chart.js"></script>
    <script src="js/components/crime-breakdown-chart.js"></script>
    <!-- Main Dashboard App -->
    <script src="js/dashboard.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
